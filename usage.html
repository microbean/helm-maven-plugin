<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-12-18 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20171218" />
    <meta http-equiv="Content-Language" content="en" />
    <title>microBean Helm Maven Plugin &#x2013; Usage and Examples</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>microBean Helm Maven Plugin</h2>
</div>
</div>
        <div class="pull-right"><a href="./" id="bannerRight"><img src="https://avatars0.githubusercontent.com/u/25515632?s=60"  alt="Î¼b helm-maven-plugin"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-12-18</li>
      <li id="projectVersion" class="pull-right">Version: 2.7.0.1.0.33</li>
      <li class="pull-right"><a href="../microbean-helm" title="microBean Helm">microBean Helm</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Documentation</li>
    <li><a href="index.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Usage</a>
  </li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a>  </li>
    <li><a href="https://github.com/microbean/helm-maven-plugin/" class="externalLink" title="Github Repository"><span class="none"></span>Github Repository</a>  </li>
    <li><a href="plugin-info.html" title="Goals"><span class="none"></span>Goals</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Usage and Examples</h1>
<p>This document describes how to use the <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/">helm-maven-plugin</a> from within your <a class="externalLink" href="http://maven.apache.org/">Maven</a> build.</p>
<div class="section">
<h2><a name="Overview"></a>Overview</h2>
<p>The <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/">helm-maven-plugin</a> project makes working with <a class="externalLink" href="https://docs.helm.sh/">Helm</a> possible from inside <a class="externalLink" href="http://maven.apache.org/">Maven</a> by supplying <a class="externalLink" href="http://maven.apache.org/">Maven</a> plugins that make use of the <a class="externalLink" href="https://microbean.github.io/microbean-helm/">microbean-helm</a> project.</p>
<p>The project consists of several <a class="externalLink" href="http://maven.apache.org/plugin-developers/index.html">mojos</a> that are fully documented in the <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/plugin-info.html">Goals</a> document.</p></div>
<div class="section">
<h2><a name="Recipes"></a>Recipes</h2>
<p>The following are recipes to follow to accomplish common <a class="externalLink" href="https://docs.helm.sh/">Helm</a>-oriented tasks as part of your <a class="externalLink" href="http://maven.apache.org/">Maven</a> build.</p>
<div class="section">
<h3><a name="Packaging_a_Helm_Chart"></a>Packaging a Helm Chart</h3>
<p>Let&#x2019;s say you have the contents of a Helm chart you want to package up. Let&#x2019;s further assume you have them in <tt>src/helm/charts/your-project</tt>, a directory in a Maven project whose <tt>artifactId</tt> is <tt>your-project</tt>. That directory might look like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">Chart.yaml
values.yaml
templates/
.helmignore
requirements.yaml
charts/
</pre></div></div>
<p>&#x2026;or might contain fewer or more files in accordance with <a class="externalLink" href="https://docs.helm.sh/developing_charts/#the-chart-file-structure">what a Helm chart needs to look like</a>. Let&#x2019;s also assume that you&#x2019;re going to package this chart up with an intent to do something else with it (like install it) later, but you haven&#x2019;t gotten that far yet.</p>
<p>You&#x2019;ll want to archive this directory as a <tt>.tar.gz</tt> file as part of the build, and place the resulting packaged chart somewhere you can make use of it later. For this simplest of all cases, you could do this with the <a class="externalLink" href="http://maven.apache.org/plugins/maven-assembly-plugin/index.html">maven-assembly-plugin</a>, but we&#x2019;ll do it with the <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/">helm-maven-plugin</a> as part of the <a class="externalLink" href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference"><tt>generate-sources</tt> lifecycle phase</a> as follows:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;plugin&gt;
  &lt;groupId&gt;org.microbean&lt;/groupId&gt;
  &lt;artifactId&gt;helm-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.7.0.1.0.25&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Package your-project chart&lt;/id&gt;
      &lt;phase&gt;generate-sources&lt;/phase&gt; &lt;!-- pick a suitable phase, though this seems good --&gt;
      &lt;goals&gt;
        &lt;goal&gt;package&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre></div></div>
<p>This example uses a minimal amount of configuration. It takes advantage of the fact that by default the <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/package-mojo.html"><tt>package</tt> goal</a> will <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/package-mojo.html#chartContentsUri">read from your <tt>src/helm/charts/${project.artifactId}</tt> directory</a> and will <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/package-mojo.html#chartTargetUri">write a file named <tt>${project.build.directory}/generated-sources/helm/charts/${project.artifactId}.tgz</tt></a>.</p>
<p>Here is the same stanza, explicitly configured this time:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;plugin&gt;
  &lt;groupId&gt;org.microbean&lt;/groupId&gt;
  &lt;artifactId&gt;helm-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.7.0.1.0.25&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Package your-project chart&lt;/id&gt;
      &lt;phase&gt;generate-sources&lt;/phase&gt; &lt;!-- pick a suitable phase, though this seems good --&gt;
      &lt;goals&gt;
        &lt;goal&gt;package&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;chartContentsUri&gt;file:${project.basedir}/src/helm/charts/${project.artifactId}&lt;/chartContentsUri&gt;
        &lt;chartTargetUri&gt;file:${project.build.directory}/generated-sources/helm/charts/${project.artifactId}.tgz&lt;/chartTargetUri&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre></div></div>
<p>Note that the <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/package-mojo.html#chartContentsUri"><tt>chartContentsUri</tt></a> and <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/package-mojo.html#chartTargetUri"><tt>chartTargetUri</tt></a> configuration elements are actually URIs. This permits writing a chart archive to an FTP or HTTP server, for example.</p></div></div>
<div class="section">
<h2><a name="Installing_a_Chart_to_Create_a_Release"></a>Installing a Chart to Create a Release</h2>
<p>Once you have a <a class="externalLink" href="https://docs.helm.sh/">Helm</a> <a class="externalLink" href="https://docs.helm.sh/developing_charts/#the-chart-file-structure">chart</a> in packaged or unpackaged form, you need to read it in and send it to <a class="externalLink" href="https://docs.helm.sh/glossary/#tiller">Tiller</a>, thus creating a <a class="externalLink" href="https://docs.helm.sh/glossary/#release"><i>release</i></a>.</p>
<p>To do this, you use the <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html"><tt>install</tt> goal</a>. <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html"><tt>install</tt></a> needs to know where your chart is, and needs to know how to connect to your <a class="externalLink" href="https://kubernetes.io/docs/setup/">Kubernetes cluster</a>. The configuration required below is to accomplish those goals.</p>
<p>Here is a minimally configured stanza that will <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#chartUrl">take a chart from <tt>file:${project.build.directory}/generated-sources/helm/charts/${project.artifactId}</tt></a> (note that the default is a directory, not a file, i.e. created perhaps by way of [Maven resources][maven-resources] or some other mechanism, and will <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#clientConfiguration">connect to the cluster</a> using <a class="externalLink" href="https://github.com/fabric8io/kubernetes-client/blob/v3.0.0/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java#L231-L321">all the mechanisms available to the <tt>DefaultKubernetesClient</tt></a> class:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;plugin&gt;
  &lt;groupId&gt;org.microbean&lt;/groupId&gt;
  &lt;artifactId&gt;helm-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.7.0.1.0.25&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Install your-project chart&lt;/id&gt;
      &lt;phase&gt;deploy&lt;/phase&gt; &lt;!-- pick a suitable phase --&gt;
      &lt;goals&gt;
        &lt;goal&gt;install&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre></div></div>
<p>This example uses a minimal amount of configuration. It takes advantage of the fact that <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#chartUrl">by default the <tt>install</tt> goal will read from your <tt>${project.build.directory}/generated-sources/helm/charts/${project.artifactId}</tt> directory</a>, if it exists, and will <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#clientConfiguration">connect to your Kubernetes cluster</a> using <a class="externalLink" href="https://github.com/fabric8io/kubernetes-client/blob/v3.0.0/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java#L231-L321">all the mechanisms available to the <tt>DefaultKubernetesClient</tt></a> class (including a <tt>~/.kube/config</tt> file if you have one). Since no <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#releaseName">explicit release name</a> is specified, the release will be named by <a class="externalLink" href="https://docs.helm.sh/glossary/#tiller">Tiller</a> according to the rules embodied by this <a class="externalLink" href="https://github.com/technosophos/moniker#monicker-generate-cute-random-names">Github project</a>.</p>
<p>Here is the same stanza, this time fully configured, and specifying a <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#releaseName">release name</a>, and <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#valuesYaml">specifying a value</a> for your made-up chart&#x2019;s hypothetical <tt>frobnicationInterval</tt> setting:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;plugin&gt;
  &lt;groupId&gt;org.microbean&lt;/groupId&gt;
  &lt;artifactId&gt;helm-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.7.0.1.0.25&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Install your-project chart&lt;/id&gt;
      &lt;phase&gt;deploy&lt;/phase&gt; &lt;!-- pick a suitable phase --&gt;
      &lt;goals&gt;
        &lt;goal&gt;install&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;chartUrl&gt;file:${project.build.directory}/generated-sources/helm/charts/${project.artifactId}&lt;/chartUrl&gt;
        &lt;releaseName&gt;your-first-release&lt;/releaseName&gt;
        &lt;valuesYaml&gt;&lt;[!CDATA[frobnicationInterval: 37]]&gt;&lt;/valuesYaml&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre></div></div>
<p>Note in particular the <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#valuesYaml"><tt>&lt;valuesYaml&gt;</tt> setting</a>; <tt>CDATA</tt> will help you here since most non-trivial YAML requires strict indentation.</p>
<p>In the <tt>&lt;configuration&gt;</tt> element, you could, if you wanted, set up a custom <a class="externalLink" href="https://github.com/fabric8io/kubernetes-client/blob/v3.0.0/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java#L231-L321"><tt>Config</tt></a> object, by specifying a <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/install-mojo.html#clientConfiguration"><tt>&lt;clientConfiguration&gt;</tt> child element</a> and following the <a class="externalLink" href="https://maven.apache.org/guides/mini/guide-configuring-plugins.html#Configuring_Parameters">rules of Maven plugin instantiation</a>.</p>
<div class="section">
<h3><a name="Listing_the_Contents_of_a_Release"></a>Listing the Contents of a Release</h3>
<p>This example shows you how to make use of a release that has already been installed into your Kubernetes cluster. The key thing to look at here is the <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/content-mojo.html#releaseContentListeners">listeners-oriented stanza</a>, which shows how you can customize the basic behavior. The behavior here is of the log-to-<tt>STDOUT</tt> variety, but if you supplied your own listener you could do more interesting things:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;plugin&gt;
  &lt;groupId&gt;org.microbean&lt;/groupId&gt;
  &lt;artifactId&gt;helm-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.7.0.1.0.25&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;List the contents of your-first-release&lt;/id&gt;
      &lt;phase&gt;test&lt;/phase&gt; &lt;!-- pick a suitable phase --&gt;
      &lt;goals&gt;
        &lt;goal&gt;content&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;releaseName&gt;your-first-release&lt;/releaseName&gt;
        &lt;releaseContentListeners&gt;
          &lt;abstractReleaseContentListener/&gt;
        &lt;/releaseContentListeners&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre></div></div>
<p>Note the <tt>&lt;abstractReleaseContentListener/&gt;</tt> element, which <a class="externalLink" href="https://maven.apache.org/guides/mini/guide-configuring-plugins.html#Configuring_Parameters">follows the rules of Maven plugin configuration</a>, which allows for customizable behavior. Here, the <tt>org.microbean.helm.maven.AbstractReleaseContentListener</tt> class is instantiated.</p></div>
<div class="section">
<h3><a name="Uninstalling_a_Release"></a>Uninstalling a Release</h3>
<p>Building on what we&#x2019;ve learned, here&#x2019;s a stanza that <a class="externalLink" href="https://microbean.github.io/helm-maven-plugin/uninstall-mojo.html">uninstalls a release using the <tt>uninstall</tt> goal</a>:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;plugin&gt;
  &lt;groupId&gt;org.microbean&lt;/groupId&gt;
  &lt;artifactId&gt;helm-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.7.0.1.0.25&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Unnstall your-first-release&lt;/id&gt;
      &lt;phase&gt;test&lt;/phase&gt; &lt;!-- pick a suitable phase --&gt;
      &lt;goals&gt;
        &lt;goal&gt;uninstall&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;purge&gt;true&lt;/purge&gt;
        &lt;releaseName&gt;your-first-release&lt;/releaseName&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017
<a href="http://microbean.systems/">microBean</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
